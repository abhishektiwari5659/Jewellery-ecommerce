<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jewelry E-Commerce</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <!-- Dialogflow Messenger Script -->
    <script src="https://www.gstatic.com/dialogflow-console/fast/messenger/bootstrap.js?v=1"></script>
</head>

<body>
    <header>
        <div class="container">
            <div class="logo">
                <img src="uploads/logo.jpg" alt="Jewelry Store Logo">
            </div>
            <nav class="navbar">
                <ul>
                    <li><a href="index.html">Home</a></li>
                    <li><a href="shop.html">Shop</a></li>
                    <li><a href="about.html">About</a></li>
                    <li><a href="contact.html">Contact</a></li>
                    <li><a href="category.html">Category</a></li>
                </ul>
            </nav>
            <div class="icons">
                <div class="cart-icon">
                    <a href="cart.html"><i class="fas fa-shopping-cart"></i></a>
                    <span id="cart-count" class="cart-count">0</span>
                </div>
                <a href="login.html"><i class="fas fa-user"></i></a>
            </div>
        </div>
    </header>

    <main>
        <section class="hero">
            <div class="hero-content">
                <h1>Discover Elegance</h1>
                <p>Explore our exquisite collection of fine jewelry crafted to perfection.</p>
                <a href="shop.html" class="btn-primary">Shop Now</a>
                <a href="about.html" class="btn-secondary">Learn More</a>
            </div>
        </section>

        <!-- Static Featured Products Section -->
        <section class="featured-products" id="static-featured-products">
            <h2>Exclusive Collection</h2>
            <div class="products">
                <div class="product">
                    <img src="IMG20240626094248.jpg" alt="Product 1">
                    <h3>Regal Pearl Danglers</h3>
                    <p>₹ 199</p>
                    <button class="btn view-details" data-id="static-1">View Details</button>
                </div>
                <div class="product">
                    <img src="IMG20240626112752.jpg" alt="Product 2">
                    <h3>Twilight Whisper Studs</h3>
                    <p>₹ 299</p>
                    <button class="btn view-details" data-id="static-2">View Details</button>
                </div>
                <div class="product">
                    <img src="IMG20240626114924.jpg" alt="Product 3">
                    <h3>Golden Mirage Bracelet</h3>
                    <p>₹ 399</p>
                    <button class="btn view-details" data-id="static-3">View Details</button>
                </div>
            </div>
        </section>

        <!-- Dynamic Featured Products Section -->
        <section class="featured-products" id="dynamic-featured-products">
            <h2>New Arrivals</h2>
            <div class="products" id="products">
                <!-- Products will be displayed here dynamically -->
            </div>
        </section>
    </main>

    <footer>
        <div class="footer-content">
            <p>&copy; 2024 Jewelry Store. All rights reserved.</p>
            <div class="social-media">
                <a href="#"><i class="fab fa-facebook-f"></i></a>
                <a href="#"><i class="fab fa-twitter"></i></a>
                <a href="#"><i class="fab fa-instagram"></i></a>
                <a href="#"><i class="fab fa-pinterest"></i></a>
            </div>
        </div>
    </footer>

    <div id="productModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2 id="modalTitle"></h2>
            <img id="modalImage" src="" alt="Product Image" style="width:100%">
            <p id="modalPrice"></p>
            <p id="modalDescription"></p>
        </div>
    </div>

    <!-- Dialogflow Messenger -->
    <df-messenger
        intent="WELCOME"
        chat-title="Jewelry_Store_Bot"
        agent-id="1f1d0f7e-064e-4081-9b11-b63917694609"
        language-code="en">
    </df-messenger>

    <script>
        const apiUrl = 'http://localhost:5000/api/products';

        // Function to open the modal with product details
        function openModal(product) {
            document.getElementById('modalTitle').innerText = product.name;
            const imagePath = product.image.includes('/') ? product.image : `uploads/${product.image}`;
            document.getElementById('modalImage').src = imagePath;
            document.getElementById('modalPrice').innerText = `₹ ${product.price}`;
            document.getElementById('modalDescription').innerText = product.description;
            document.getElementById('productModal').style.display = 'block';
        }

        // Function to close the modal
        function closeModal() {
            document.getElementById('productModal').style.display = 'none';
        }

        // Event listener for static products
        document.querySelectorAll('#static-featured-products .view-details').forEach(button => {
            button.addEventListener('click', (event) => {
                const productId = event.target.dataset.id;
                const staticProducts = {
                    "static-1": { name: "Regal Pearl Danglers", price: "199.99", description: "Traditional yet chic, these pearl danglers bring sophistication to any ensemble.", image: "IMG20240626094248.jpg" },
                    "static-2": { name: "Twilight Whisper Studs", price: "299.99", description: "Small yet eye-catching studs, crafted with sapphires.", image: "IMG20240626112752.jpg" },
                    "static-3": { name: "Golden Mirage Bracelet", price: "399.99", description: "A sleek, gold-plated bracelet with a twisted design, exuding sophistication.", image: "IMG20240626114924.jpg" },
                };
                openModal(staticProducts[productId]);
            });
        });

        // Function to fetch and display dynamic products
        async function fetchProducts() {
            try {
                const response = await fetch(apiUrl);
                const products = await response.json();
                const productsContainer = document.getElementById('products');
                productsContainer.innerHTML = '';

                products.forEach(product => {
                    const productElement = document.createElement('div');
                    productElement.className = 'product';
                    productElement.innerHTML = `
                        <img src="http://localhost:5000${product.image}" alt="${product.name}">
                        <h3>${product.name}</h3>
                        <p>₹ ${product.price}</p>
                        <button class="btn view-details" data-id="${product._id}">View Details</button>
                    `;
                    productsContainer.appendChild(productElement);
                });
            } catch (error) {
                console.error('Error fetching products:', error);
            }
        }

        // Event listener for dynamic products
        document.addEventListener('DOMContentLoaded', () => {
            fetchProducts();

            document.getElementById('products').addEventListener('click', async (event) => {
                if (event.target.classList.contains('view-details')) {
                    const productId = event.target.dataset.id;
                    const response = await fetch(`${apiUrl}/${productId}`);
                    const product = await response.json();
                    openModal(product);
                }
            });

            document.querySelector('.close').addEventListener('click', closeModal);

            window.addEventListener('click', (event) => {
                if (event.target === document.getElementById('productModal')) {
                    closeModal();
                }
            });
        });

        // Function to update the cart count
        function updateCartCount() {
            const cart = JSON.parse(localStorage.getItem('cart')) || [];
            const count = cart.reduce((total, item) => total + (item.quantity || 1), 0);
            document.getElementById('cart-count').textContent = count;
        }

        // Initialize cart count
        document.addEventListener('DOMContentLoaded', updateCartCount);
    </script>

</body>

</html>
